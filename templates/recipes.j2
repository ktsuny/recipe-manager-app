<html>

<head>
  <title>Recipe Manager</title>
  <link href="static/style.css" rel="stylesheet" type="text/css" />

  <script language="JavaScript">
    /*
    * four DIVS: browse, insert, update, delete
    * this function sets one visible the others not
    */
    function showform(dowhat) {

      if (dowhat == 'insert') {
        document.getElementById('browse').style.display = 'none';
        document.getElementById('insert').style.display = 'block';
        document.getElementById('update').style.display = 'none';
        document.getElementById('delete').style.display = 'none';
      }
      else if (dowhat == 'update') {
        document.getElementById('browse').style.display = 'none';
        document.getElementById('insert').style.display = 'none';
        document.getElementById('update').style.display = 'block';
        document.getElementById('delete').style.display = 'none';
      }
      else if (dowhat == 'delete') {
        document.getElementById('browse').style.display = 'none';
        document.getElementById('insert').style.display = 'none';
        document.getElementById('update').style.display = 'none';
        document.getElementById('delete').style.display = 'block';
      }
      else if (dowhat == 'all') {
        document.getElementById('browse').style.display = 'block';
        document.getElementById('insert').style.display = 'block';
        document.getElementById('update').style.display = 'block';
        document.getElementById('delete').style.display = 'block';
      }
      else { //by default display browse
        document.getElementById('browse').style.display = 'block';
        document.getElementById('insert').style.display = 'none';
        document.getElementById('update').style.display = 'none';
        document.getElementById('delete').style.display = 'none';
      }
    }
    function newRecipe() { showform('insert'); }
    function updateRecipe(recipe_id) { showform('update'); }
    function deleteRecipes(recipe_id) { showform('delete'); }
    function browseRecipes() { showform('browse'); }
    function showAll() { showform('all'); }
    document.addEventListener("DOMContentLoaded", function () {
      // Ensures the DOM is fully loaded before attaching event listeners
      var generateRandomBtn = document.getElementById("generateRandom");
      if (generateRandomBtn) {
        generateRandomBtn.addEventListener("click", function () {
          fetch('http://localhost:5001/random') // Adjust the URL based on your microservice location
            .then(response => response.json())
            .then(data => {
              document.getElementById("randomNumber").textContent = "Random Number: " + data.number;
            })
            .catch(error => console.error('Error:', error));
        });
      }
    });
  </script>
</head>

<body onload="browseRecipes()">

  <h1>Recipes</h1>

  <!-- nav menue bar -->
  <nav class="global">
    <a href="recipes">Home</a> <a href="create">Create Recipe</a> <a href="tutorial">Tutorial</a>

  </nav>
  <form action="/search" method="get">
    <input type="text" id="search" name="search" placeholder="Search for recipes...">
    <button type="submit">Search</button>
    <button id="generateRandom">Generate Random Recipe</button>
  </form>
    

  <h2>Welcome! This app will allow you to store and access your recipes easily. You can view, add, update, and delete
    your favorate recipes.
    <br>You can use the search bar for when you are cooking with ingredients you have on hand, or the random recipe
    generator if you don't feel like choosing.
  </h2>
  <a href="#" onClick="newRecipe()" class="add-recipe-btn">+</a>



  <div id="browse">

    <table border="1" cellpadding="5">
      <!-- Access data tuple passed from app.py -->
      {% if data %}
      <thead>
        <tr>
          <!-- Iterate through each key in the first entry to get the column name -->
          {% for key in data[0].keys() %}

          <!-- Create a <th> tag with the key inside of it, this will be our header row -->
          <th scope="col" data-field="{{ key }}" data-filter-control="input">{{ key }}</th>

          <!-- End of this for loop -->
          {% endfor %}
        </tr>

      <tbody>
        <!-- Now, iterate through every item in data -->{% for item in data %}
        <tr>
          <!-- Then iterate through every key in the current item dictionary -->
          {% for key in item.keys() %}

          <!-- Create a <td> element with the value of that key in it -->
          <td> {{item[key]}} </td>
          {% endfor %}

          <!-- Create our edit/delete buttons -->
          <td><a href="edit_recipes/{{item.recipe_id}}" class="btn btn-default">Edit</a></td>
          <td><a href="delete_recipes/{{item.recipe_id}}" class="btn btn-default">Delete</a></td>


        </tr>
        {% endfor %}
        {% endif %}
    </table>
    <p>&nbsp;</p>
  </div> <!-- browse -->

  <div id="insert">
    <!-- form to INSERT new data into Recipes table-->
    <form id="insertRecipe" action="/recipes" method="post">
      <legend><strong>Add Recipe</strong></legend>
      <fieldset>
        <!-- placeholder shows ghost text, required forces an input, pattern forces input adherence -->
        <label for="recipe_name">recipe name</label>
        <textarea class="form-control" id="recipe_name" name="recipe_name" placeholder="" required></textarea>

        <label for="serving_size">serving size:</label>
        <input type="number" class="form-control" id="serving_size" name="serving_size" pattern="[A-Za-z0-9]{1,}"
          placeholder="" min="0" required>

        <label for="ingredients">Ingredients:</label>
        <textarea class="form-control" id="ingredients" name="ingredients" placeholder="" required></textarea>

        <label for="steps">Steps:</label>
        <textarea class="form-control" id="steps" name="steps" placeholder="" required></textarea>


      </fieldset>

      <!-- Create 'Add Recipe' and 'Cancel' buttons -->
      <input type="submit" value="Add Recipe" name="Add_Recipe" class="btn btn-primary" style="margin:.5rem;">
      <input class="btn" type="button" value="Cancel" onClick="browseRecipes()">
    </form>
  </div><!--insert-->




</body>

</html>